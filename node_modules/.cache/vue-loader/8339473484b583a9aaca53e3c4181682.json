{"remainingRequest":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\src\\pages\\movieDetail.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\src\\pages\\movieDetail.vue","mtime":1651857760315},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\css-loader\\index.js","mtime":1646917044546},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1646917096706},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\postcss-loader\\src\\index.js","mtime":1646917102093},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1646917067899},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\vue-loader\\lib\\index.js","mtime":1646917096669}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.movieDetail {\r\n\r\n}\r\n#movieTitle{\r\n\r\n}\r\n#movieCover{\r\n  margin-top: 1em;\r\n  width: 9em;\r\n  height: 12em;\r\n}\r\n.movieDirector{\r\n  width: 7em;\r\n  /*background: #E1F3D8;*/\r\n}\r\n.movieActor{\r\n  width: 7em;\r\n  /*background: #E1F3D8;*/\r\n}\r\n",{"version":3,"sources":["movieDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiZA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"movieDetail.vue","sourceRoot":"src/pages","sourcesContent":["<template>\r\n  <div class=\"movieDetail\">\r\n    <el-row>\r\n      <el-col :span=\"12\" :offset=\"3\">\r\n        <div id=\"movieTitle\">\r\n          <h1>{{this.movieName}} <i v-if=\"$cookie.get('type')==0\" class=\"el-icon-s-tools\" @click=\"modifyMovie(mid)\" ></i></h1>\r\n\r\n        </div>\r\n      </el-col>\r\n    </el-row>\r\n    <el-row>\r\n      <el-col :span=\"2\" :offset=\"3\">\r\n        <div id=\"movieCover\" style=\"background: #2c3e50\" >\r\n          <el-image v-if=\"imgLoad\" :src=\"this.$store.getters.getMediaUrl + movieCover\" :fit=\"'scale-down'\"></el-image>\r\n        </div>\r\n      </el-col>\r\n      <el-col :span=\"7\" :offset=\"1\">\r\n        <div id=\"movieInfo\">\r\n          <el-descriptions class=\"margin-top\" title=\"\" :column=\"1\">\r\n            <el-descriptions-item label=\"导演\" label-class-name=\"movieDirector\">\r\n              <div style=\"cursor: pointer\" @click=\"alert(directorList)\">\r\n                <span v-for=\"d in this.directorList\" @click=\"jumpPersonDetail(d.directorIdOld)\">\r\n                  {{d.personName}}/\r\n                </span>\r\n              </div>\r\n            </el-descriptions-item>\r\n            <el-descriptions-item label=\"主演\" label-class-name=\"movieActor\">\r\n              <span v-for=\"d in this.actorList\" @click=\"jumpPersonDetail(d.actorIdOld)\">\r\n                {{d.personName}}/\r\n              </span>\r\n            </el-descriptions-item>\r\n            <el-descriptions-item label=\"类型\" label-class-name=\"movieDirector\">\r\n              <el-tag size=\"small\" v-for=\"t in this.typeList\" style=\"margin-right: 3px\">{{ t }}</el-tag>\r\n            </el-descriptions-item>\r\n            <el-descriptions-item label=\"语言\" label-class-name=\"movieDirector\">{{ this.movieLang }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"电影时长\" label-class-name=\"movieDirector\">{{ this.movieTime }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"制片国家/地区\" label-class-name=\"movieDirector\">{{ this.movieRegion }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"上映时间\" label-class-name=\"movieDirector\">{{ this.movieRelDate }}</el-descriptions-item>\r\n          </el-descriptions>\r\n        </div>\r\n      </el-col>\r\n      <el-col :span=\"1\"><br/>\r\n        <el-divider direction=\"vertical\"></el-divider>\r\n      </el-col>\r\n      <el-col :span=\"4\">\r\n        评分\r\n        <el-rate\r\n            v-model=\"value\"\r\n            disabled\r\n            show-score\r\n            text-color=\"#ff9900\"\r\n            score-template=\"{value}\">\r\n        </el-rate>\r\n        <table style=\"width: 13em\">\r\n          <tr>\r\n            <td style=\"width: 2em\">1星</td>\r\n            <td>\r\n              <el-progress :percentage=\"this.percentOneStar\" ></el-progress>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>2星</td>\r\n            <td>\r\n              <el-progress :percentage=\"this.percentTwoStar\"></el-progress>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>3星</td>\r\n            <td>\r\n              <el-progress :percentage=\"this.percentThreeStar\"></el-progress>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>4星</td>\r\n            <td>\r\n              <el-progress :percentage=\"this.percentFourStar\"></el-progress>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>5星</td>\r\n            <td>\r\n              <el-progress :percentage=\"this.percentFiveStar\"></el-progress>\r\n            </td>\r\n          </tr>\r\n        </table>\r\n      </el-col>\r\n    </el-row>\r\n    <el-row>\r\n      <el-col :span=\"10\" :offset=\"3\">\r\n        <div ></div>\r\n      </el-col>\r\n    </el-row>\r\n    <el-row>\r\n      <el-col :offset=\"3\" :span=\"15\">\r\n        <h4> 我的评价：</h4>\r\n        <el-rate  v-model=\"userScore\" show-text></el-rate>\r\n        <h4>{{this.movieName}}的电影简介</h4>\r\n        {{this.movieBio}}\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <el-row style=\"margin-top: 2em\">\r\n      <el-col :offset=\"3\" :span=\"15\">\r\n        <el-form ref=\"commentForm\" :model=\"commentForm\" label-width=\"80px\" size=\"mini\">\r\n          <el-form-item label=\"我的评论\">\r\n            <el-input type=\"textarea\" placeholder=\"请输入内容\" v-model=\"commentForm.userComment\" maxlength=\"500\" show-word-limit style=\"margin-bottom: 1em\">\r\n            </el-input>\r\n          </el-form-item>\r\n          <el-form-item style=\"text-align: right\">\r\n            <el-button type=\"success\" @click=\"submitComment\" size=\"mini\" >评论</el-button>\r\n          </el-form-item>\r\n        </el-form>\r\n\r\n        <div style=\"margin-top: 1em;margin-bottom: 1em\">\r\n          <p style=\"color:#007722; font-size: 14px\" >········最热影评········共计{{this.commentNum}}条评论</p>\r\n        </div>\r\n\r\n        <div v-for=\"(c,index) in this.commentList\" :key=\"index\"><!--评论模块-->\r\n          <el-row>\r\n            <el-col :span=\"3\" style=\"font-size: 12px;\">\r\n              <span>\r\n                {{c.userName}}\r\n              </span>\r\n            </el-col>\r\n            <el-col :span=\"5\">\r\n                <el-rate v-model=\"c.score\" disabled text-color=\"#ff9900\"></el-rate>\r\n            </el-col>\r\n            <el-col :span=\"4\" :offset=\"12\" style=\"text-align: right\">\r\n              {{c.vote}}\r\n              <i class=\"el-icon-star-on\" v-if=\"voteStar[index]\" style=\"color:#E6A23C\" @click=\"cancelCommentVote(c.id,$cookie.get('userId'),index)\"></i>\r\n              <i class=\"el-icon-star-off\" v-else @click=\"commentVote(c.id,$cookie.get('userId'),index)\" ></i>\r\n            </el-col>\r\n          </el-row>\r\n          <el-row >\r\n            <el-col>\r\n            <span style=\"font-size: 13px\">\r\n              {{c.comment}}\r\n            </span>\r\n            </el-col>\r\n          </el-row>\r\n          <el-divider></el-divider>\r\n        </div>\r\n\r\n        <el-pagination\r\n            background\r\n            :current-page.sync=\"curPage\"\r\n            layout=\"prev, pager, next\"\r\n            :total=\"this.commentNum\"\r\n            @current-change=\"getCommentsByMid\"\r\n        >\r\n        </el-pagination>\r\n      </el-col>\r\n    </el-row>\r\n\r\n\r\n\r\n\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: {\r\n    mid: {\r\n      type: Number,\r\n      default: 0\r\n    }\r\n  },\r\n  name: \"movieDetail\",\r\n  data(){\r\n    return{\r\n      imgLoad:false,\r\n      commentForm:{\r\n        userComment:'',\r\n      },\r\n      movieName:'',//电影名称\r\n      movieBio:'',//电影简介\r\n      movieTime:\"\",//电影时长\r\n      movieRelDate:\"\",//电影发布日\r\n      movieLang:\"\",//电影语言\r\n      movieRegion:\"\",//电影生产国地区\r\n      movieCover:\"\",//电影封面\r\n      typeList:[],//电影的类型列表\r\n      actorList:[],//演员列表\r\n      directorList:[],//导演列表，\r\n      value:6,//电影平均分\r\n      percentOneStar:0,//1星打分人数百分比\r\n      percentTwoStar:0,//2星打分人数百分比\r\n      percentThreeStar:0,//3星打分人数百分比\r\n      percentFourStar:0,//4星打分人数百分比\r\n      percentFiveStar:0,//5星打分人数百分比\r\n      userScore:0,//当前用户给电影的打分\r\n      commentNum:0,//评论总数\r\n      commentList:[],//评论列表，userName,uid,comment,vote,score,id\r\n      userText:'',\r\n      curPage:1,//分页的当前页\r\n      voteStar:[0,0,0,0,0,0,0,0,0,0]//评论点赞\r\n    };\r\n\r\n  },\r\n  methods:{\r\n    getMovieInfo(){\r\n      this.$axios({\r\n        method:\"get\",\r\n        url:\"/getMovieByMovieId\",\r\n        params:{\r\n          mid:this.mid,\r\n        }\r\n      }).then(res=>{\r\n        if (res.data.result){\r\n          this.movieName=res.data.movieInfo.movieName;\r\n          this.movieBio=res.data.movieInfo.movieBio;\r\n          this.movieLang = res.data.movieInfo.movieLang;\r\n          this.movieTime=res.data.movieInfo.movieTime;\r\n          this.movieRelDate=res.data.movieInfo.movieRelDate;\r\n          this.movieRegion = res.data.movieInfo.movieRegion;\r\n          this.movieCover = res.data.movieInfo.movieImg;\r\n          this.actorList = res.data.actor;\r\n          this.typeList = res.data.type;\r\n          this.directorList = res.data.director;\r\n          this.imgLoad=true;\r\n        }else{\r\n          this.$message.error('无此电影404');\r\n          this.$router.go(-1);\r\n        }\r\n      })\r\n    },\r\n    getRateByMid(){\r\n      this.$axios({\r\n        method:\"get\",\r\n        url:'/getRateByMid',\r\n        params:{\r\n          mid:this.mid,\r\n        }\r\n      }).then(res=>{\r\n        if (res.data.result){\r\n          this.value=res.data.avgScore;\r\n          this.percentOneStar=res.data.perList[0];\r\n          this.percentTwoStar=res.data.perList[1];\r\n          this.percentThreeStar=res.data.perList[2];\r\n          this.percentFourStar=res.data.perList[3];\r\n          this.percentFiveStar=res.data.perList[4];\r\n        }else{\r\n          this.value=0;\r\n          this.percentOneStar=0;\r\n          this.percentTwoStar=0;\r\n          this.percentThreeStar=0;\r\n          this.percentFourStar=0;\r\n          this.percentFiveStar=0;\r\n        }\r\n      })\r\n    },\r\n    getCommentsByMid(){\r\n      let hasU = false\r\n      if (this.$cookie.get('userId')){\r\n        hasU = true\r\n      }\r\n      this.$axios({\r\n        method:\"get\",\r\n        url:'/getCommentsByMid',\r\n        params:{\r\n          mid:this.mid,\r\n          hasUid:hasU,\r\n          uid:this.$cookie.get('userId'),\r\n          curPage:this.curPage,\r\n        }\r\n      }).then(res=>{\r\n        this.commentNum=res.data.commentNum\r\n        this.commentList=res.data.commentList\r\n        this.voteStar=res.data.voteStar\r\n        if (res.data.userComment){\r\n          this.commentForm.userComment=res.data.userComment\r\n        }\r\n      })\r\n    },\r\n    jumpPersonDetail(pid){\r\n      // console.log(\"jump\")\r\n      this.$router.push({name:'personDetail',params:{pid:parseInt(pid)}});\r\n    },\r\n    commentVote(cid,uid,index){\r\n      if (this.$cookie.get('userId')){\r\n        this.$axios({\r\n          method:\"get\",\r\n          url:'/commentVote',\r\n          params:{\r\n            cid:cid,\r\n            uid:uid,\r\n          }\r\n        }).then(res=>{\r\n          if (res.data.result){\r\n            this.voteStar[index]=1\r\n            this.getCommentsByMid()\r\n          }\r\n        })\r\n      }else{\r\n        this.$message.error('请先登录再操作')\r\n        this.$router.push('/log')\r\n      }\r\n    },\r\n    cancelCommentVote(cid,uid,index){\r\n      if (this.$cookie.get('userId')){\r\n        this.$axios({\r\n          method:\"get\",\r\n          url:'/cancelCommentVote',\r\n          params:{\r\n            cid:cid,\r\n            uid:uid,\r\n          }\r\n        }).then(res=>{\r\n          if (res.data.result){\r\n            this.voteStar[index]=0\r\n            this.getCommentsByMid()\r\n          }\r\n        })\r\n      }else{\r\n        this.$message.error('请先登录再操作')\r\n        this.$router.push('/log')\r\n      }\r\n    },\r\n    submitComment(){\r\n      let userRate = this.userScore\r\n      let userComment = this.commentForm.userComment\r\n      let uid = this.$cookie.get('userId')\r\n      let mid = this.mid\r\n      if (uid){\r\n        this.$axios({\r\n          method:\"get\",\r\n          url:'/submitComment',\r\n          params:{\r\n            uid:uid,\r\n            mid:mid,\r\n            score: userRate,\r\n            comment: userComment,\r\n          }\r\n        }).then(res=>{\r\n          if(res.data.result){\r\n            this.$message.warning('评论成功')\r\n            this.getCommentsByMid()\r\n          }else{\r\n            this.$message.error('请先登录，再评价')\r\n          }\r\n        })\r\n      }else {\r\n        this.$message.error('请先登录，再评论')\r\n      }\r\n    },\r\n    modifyMovie(mid){\r\n      this.$router.push({name:'modifyMovie',params:{mid:parseInt(mid)}})\r\n    },\r\n  },\r\n  created() {\r\n    this.getMovieInfo()\r\n    this.getRateByMid()\r\n    this.getCommentsByMid()\r\n    if(this.$cookie.get('userId')){\r\n      this.$axios({\r\n        method:\"get\",\r\n        url:'/getRateByMidAndUid',\r\n        params:{\r\n          uid:this.$cookie.get('userId'),\r\n          mid:this.mid\r\n        },\r\n      }).then(res=>{\r\n        if (res.data.result){\r\n          this.userScore = res.data.score;\r\n        }else{\r\n          this.userScore = 0;\r\n        }\r\n      })\r\n    }\r\n  },\r\n  watch:{\r\n    userScore:function (newval,oldval){\r\n      if(this.$cookie.get('userId')){\r\n        this.$axios({\r\n          method:\"get\",\r\n          url:'/rateMovie',\r\n          params:{\r\n            uid:this.$cookie.get('userId'),\r\n            mid:this.mid,\r\n            score:newval,\r\n          }\r\n        }).then(res=>{\r\n          if(res.data.result){\r\n            this.$message.success('评分成功')\r\n            console.log('评分成功')\r\n            this.getCommentsByMid()\r\n          }\r\n        })\r\n      }else{\r\n        this.$router.push({name:'log'})\r\n      }\r\n\r\n    }\r\n  },\r\n\r\n}\r\n</script>\r\n\r\n<style>\r\n.movieDetail {\r\n\r\n}\r\n#movieTitle{\r\n\r\n}\r\n#movieCover{\r\n  margin-top: 1em;\r\n  width: 9em;\r\n  height: 12em;\r\n}\r\n.movieDirector{\r\n  width: 7em;\r\n  /*background: #E1F3D8;*/\r\n}\r\n.movieActor{\r\n  width: 7em;\r\n  /*background: #E1F3D8;*/\r\n}\r\n</style>"]}]}