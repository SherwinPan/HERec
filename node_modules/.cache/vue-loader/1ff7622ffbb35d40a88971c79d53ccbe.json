{"remainingRequest":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\src\\pages\\createMovie.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\src\\pages\\createMovie.vue","mtime":1651853487392},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1646917067899},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\babel-loader\\lib\\index.js","mtime":1646917103326},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1646917067899},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\vue-loader\\lib\\index.js","mtime":1646917096669}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nexport default {\r\n  name: \"createMovie\",\r\n  data(){\r\n    return{\r\n      movieFrom:{\r\n        movieName:'',\r\n        movieCover:'',\r\n        movieBio:'',\r\n        movieRegion:[],\r\n        movieTime:'',\r\n        movieLang:[],\r\n        movieRelDate:'',\r\n        actorList:[],\r\n        directorList:[],\r\n        typeList:[],\r\n      },\r\n      fileList:[],\r\n      options:[],\r\n      directOptions:[],\r\n      list:[],\r\n      loading: false,\r\n      movieFromRules:{\r\n        movieName: [\r\n          {required: true, message: '请输入电影名', trigger: 'blur'},\r\n        ],\r\n      },\r\n    };\r\n  },\r\n  methods:{\r\n    checkId() {\r\n      let uid = this.$cookie.get('userId')\r\n      let type = this.$cookie.get('type')\r\n      if (type==1){\r\n        this.$router.go(-1)\r\n      }else{\r\n        this.$axios({\r\n          method:\"get\",\r\n          url:'/getUserById',\r\n          params:{\r\n            userId:uid,\r\n          },\r\n        }).then(res=>{\r\n          if(res.data.result){\r\n            if(res.data.type){\r\n              this.$cookie.remove('userId');\r\n              this.$cookie.remove('type');\r\n              this.$router.push('/log')\r\n              this.$message.error('非管理员用户，请重新登陆')\r\n            }else{\r\n              this.$message.warning('欢迎登录HERec管理员')\r\n            }\r\n          }else{\r\n            this.$cookie.remove('userId');\r\n            this.$cookie.remove('type');\r\n            this.$router.push('/log')\r\n            this.$message.error('非管理员用户，请重新登陆')\r\n          }\r\n        })\r\n      }\r\n    },\r\n    getPerson(){\r\n      this.$axios({\r\n        method:\"get\",\r\n        url:'/getPerson',\r\n      }).then(res=>{\r\n        this.list = res.data.personList.map(item=>{\r\n          return{\r\n            value:item[0],\r\n            label:item[1],\r\n          }\r\n        })\r\n      })\r\n    },\r\n    selectActor(query) {\r\n      if (query !== '') {\r\n        this.loading = true;\r\n        setTimeout(() => {\r\n          this.loading = false;\r\n          this.options = this.list.filter(item => {\r\n            return item.label.toLowerCase()\r\n                .indexOf(query.toLowerCase()) > -1;\r\n          });\r\n        }, 200);\r\n      } else {\r\n        this.options = [];\r\n      }\r\n    },\r\n    selectDirector(query) {\r\n      if (query !== '') {\r\n        this.loading = true;\r\n        setTimeout(() => {\r\n          this.loading = false;\r\n          this.directOptions = this.list.filter(item => {\r\n            return item.label.toLowerCase()\r\n                .indexOf(query.toLowerCase()) > -1;\r\n          });\r\n        }, 200);\r\n      } else {\r\n        this.directOptions = [];\r\n      }\r\n    },\r\n\r\n    submitMovieForm(form){\r\n      this.$refs[form].validate((valid) => {\r\n        if (valid) {\r\n          this.$refs.upload.submit();\r\n        } else {\r\n          this.$message.error('请仔细填写信息哦');\r\n          return false;\r\n        }\r\n      })\r\n    },\r\n    resetForm(form){\r\n\r\n    },\r\n    httpRequest(param){\r\n      console.log(param)\r\n      let fileObj = param.file\r\n      let fd = new FormData()\r\n      fd.append('file',fileObj)\r\n      for (let i in this.movieFrom) {\r\n        console.log(i)\r\n        fd.append(i, this.movieFrom[i])\r\n      }\r\n      this.$axios({\r\n            method: 'post',\r\n            url: '/createMovie',\r\n            data: fd,\r\n            header: {\r\n              'Content-Type': 'multipart/form-data'  //如果写成contentType会报错\r\n            }\r\n          }\r\n      ).then(res => {\r\n        if (res.data.result === false) {\r\n          this.$message.error('注册失败，请重新处理信息');\r\n          //修改失败，重新注册\r\n        } else {\r\n          this.$message({\r\n            message: '初始化成功',\r\n            type: 'warning'\r\n          });\r\n        }\r\n      })\r\n\r\n    },\r\n    handleAvatarSuccess(res, file) {\r\n      this.imageUrl = URL.createObjectURL(file.raw);\r\n    },\r\n    beforeAvatarUpload(file) {\r\n      let types = ['image/jpeg', 'image/jpg', 'image/png'];\r\n      const isJPG = types.includes(file.type);\r\n      const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n      if (!isJPG) {\r\n        this.$message.error('上传图片只能是 JPG 格式!');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!');\r\n      }\r\n      return isJPG && isLt2M;\r\n    },\r\n\r\n  },\r\n  created() {\r\n    this.checkId()\r\n    this.getPerson()\r\n  },\r\n  mounted() {\r\n\r\n  },\r\n}\r\n",{"version":3,"sources":["createMovie.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"createMovie.vue","sourceRoot":"src/pages","sourcesContent":["<template>\r\n  <div class=\"createMovie\">\r\n    <el-row>\r\n      <el-col :span=\"10\" :offset=\"3\">\r\n        <h1>新建影片</h1>\r\n      </el-col>\r\n    </el-row>\r\n    <el-row style=\"margin-top: 2em\">\r\n      <el-col :span=\"15\" :offset=\"3\">\r\n        <el-form :model=\"movieFrom\" :rules=\"movieFromRules\" ref=\"movieFrom\" label-width=\"100px\">\r\n          <el-form-item label=\"电影名\" prop=\"movieName\">\r\n            <el-input v-model=\"movieFrom.movieName\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"电影时长\" prop=\"movieTime\">\r\n            <el-input type=\"number\" v-model=\"movieFrom.movieTime\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"电影简介\" prop=\"movieBio\">\r\n            <el-input type=\"textarea\" :autosize=\"{ minRows: 3, maxRows: 8}\" placeholder=\"请输入简介\" v-model=\"movieFrom.movieBio\" maxlength=\"1000\" show-word-limit >\r\n            </el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"上映日期\">\r\n            <el-date-picker\r\n                v-model=\"movieFrom.movieRelDate\"\r\n                type=\"date\"\r\n                placeholder=\"选择日期\"\r\n                format=\"yyyy 年 MM 月 dd 日\"\r\n                value-format=\"yyyy/MM/dd\">\r\n            </el-date-picker>\r\n          </el-form-item>\r\n          <el-form-item label=\"导演\">\r\n            <el-select v-model=\"movieFrom.directorList\"\r\n                       multiple\r\n                       filterable\r\n                       remote\r\n                       reserve-keyword\r\n                       placeholder=\"请输入关键词\"\r\n                       :remote-method=\"selectDirector\"\r\n                       :loading=\"loading\">\r\n              <el-option\r\n                  v-for=\"item in directOptions\"\r\n                  :key=\"item.value\"\r\n                  :label=\"item.label\"\r\n                  :value=\"item.value\">\r\n              </el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item label=\"演员\">\r\n            <el-select v-model=\"movieFrom.actorList\"\r\n                       multiple\r\n                       filterable\r\n                       remote\r\n                       reserve-keyword\r\n                       placeholder=\"请输入关键词\"\r\n                       :remote-method=\"selectActor\"\r\n                       :loading=\"loading\"\r\n                       style=\"width: 50%;\"\r\n\r\n            >\r\n              <el-option\r\n                  v-for=\"item in options\"\r\n                  :key=\"item.value\"\r\n                  :label=\"item.label\"\r\n                  :value=\"item.value\">\r\n              </el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"电影封面\">\r\n            <el-upload\r\n                class=\"avatar-uploader\"\r\n                action=\"\"\r\n                ref=\"upload\"\r\n                :limit=\"1\"\r\n                :show-file-list=\"true\"\r\n                :on-success=\"handleAvatarSuccess\"\r\n                :before-upload=\"beforeAvatarUpload\"\r\n                :http-request=\"httpRequest\"\r\n                :file-list=\"fileList\"\r\n                :auto-upload=\"false\"\r\n            >\r\n              <img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\">\r\n              <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n            </el-upload>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"语言\">\r\n            <el-checkbox-group v-model=\"movieFrom.movieLang\">\r\n              <el-checkbox label=\"汉语普通话\"></el-checkbox>\r\n              <el-checkbox label=\"汉语粤语\"></el-checkbox>\r\n              <el-checkbox label=\"汉语方言\"></el-checkbox>\r\n              <el-checkbox label=\"英语\" ></el-checkbox>\r\n              <el-checkbox label=\"日语\" ></el-checkbox>\r\n              <el-checkbox label=\"韩语\"></el-checkbox>\r\n              <el-checkbox label=\"德语\"></el-checkbox>\r\n              <el-checkbox label=\"法语\"></el-checkbox>\r\n              <el-checkbox label=\"俄语\" ></el-checkbox>\r\n              <el-checkbox label=\"西班牙语\" ></el-checkbox>\r\n              <el-checkbox label=\"葡萄牙语\"></el-checkbox>\r\n              <el-checkbox label=\"印度语\"></el-checkbox>\r\n              <el-checkbox label=\"其他\"></el-checkbox>\r\n            </el-checkbox-group>\r\n          </el-form-item>\r\n          <el-form-item label=\"制片国家/地区\">\r\n            <el-checkbox-group v-model=\"movieFrom.movieRegion\">\r\n              <el-checkbox label=\"中国大陆\"></el-checkbox>\r\n              <el-checkbox label=\"中国香港\"></el-checkbox>\r\n              <el-checkbox label=\"中国台湾\"></el-checkbox>\r\n              <el-checkbox label=\"中国澳门\" ></el-checkbox>\r\n              <el-checkbox label=\"美国\" ></el-checkbox>\r\n              <el-checkbox label=\"日本\"></el-checkbox>\r\n              <el-checkbox label=\"韩国\"></el-checkbox>\r\n              <el-checkbox label=\"印度\"></el-checkbox>\r\n              <el-checkbox label=\"英国\" ></el-checkbox>\r\n              <el-checkbox label=\"德国\" ></el-checkbox>\r\n              <el-checkbox label=\"法国\"></el-checkbox>\r\n              <el-checkbox label=\"俄罗斯\"></el-checkbox>\r\n              <el-checkbox label=\"其他\"></el-checkbox>\r\n            </el-checkbox-group>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"影片类型\">\r\n            <el-checkbox-group v-model=\"movieFrom.typeList\">\r\n              <el-checkbox label=\"1\">成人</el-checkbox>\r\n              <el-checkbox label=\"2\">喜剧</el-checkbox>\r\n              <el-checkbox label=\"3\">新闻</el-checkbox>\r\n              <el-checkbox label=\"4\" >真人秀</el-checkbox>\r\n              <el-checkbox label=\"5\" >脱口秀</el-checkbox>\r\n              <el-checkbox label=\"6\">爱情</el-checkbox>\r\n              <el-checkbox label=\"7\">传记</el-checkbox>\r\n              <el-checkbox label=\"8\">动画</el-checkbox>\r\n              <el-checkbox label=\"9\" >动作</el-checkbox>\r\n              <el-checkbox label=\"10\" >短片</el-checkbox>\r\n              <el-checkbox label=\"11\">儿童</el-checkbox>\r\n              <el-checkbox label=\"12\">犯罪</el-checkbox>\r\n              <el-checkbox label=\"13\">歌舞</el-checkbox>\r\n              <el-checkbox label=\"14\">古装</el-checkbox>\r\n              <el-checkbox label=\"15\">鬼怪</el-checkbox>\r\n              <el-checkbox label=\"16\">黑色电影</el-checkbox>\r\n              <el-checkbox label=\"17\" >荒诞</el-checkbox>\r\n              <el-checkbox label=\"18\" >纪录片</el-checkbox>\r\n              <el-checkbox label=\"19\">家庭</el-checkbox>\r\n              <el-checkbox label=\"20\">惊悚</el-checkbox>\r\n              <el-checkbox label=\"21\">剧情</el-checkbox>\r\n              <el-checkbox label=\"22\" >科幻</el-checkbox>\r\n              <el-checkbox label=\"23\" >恐怖</el-checkbox>\r\n              <el-checkbox label=\"24\">历史</el-checkbox>\r\n              <el-checkbox label=\"25\">冒险</el-checkbox>\r\n              <el-checkbox label=\"26\">奇幻</el-checkbox>\r\n              <el-checkbox label=\"27\">情色</el-checkbox>\r\n              <el-checkbox label=\"28\">同性</el-checkbox>\r\n              <el-checkbox label=\"29\">武侠</el-checkbox>\r\n              <el-checkbox label=\"30\" >舞台艺术</el-checkbox>\r\n              <el-checkbox label=\"31\">西部</el-checkbox>\r\n              <el-checkbox label=\"32\">戏曲</el-checkbox>\r\n              <el-checkbox label=\"33\">悬疑</el-checkbox>\r\n              <el-checkbox label=\"34\" >音乐</el-checkbox>\r\n              <el-checkbox label=\"35\" >运动</el-checkbox>\r\n              <el-checkbox label=\"36\">灾难</el-checkbox>\r\n              <el-checkbox label=\"37\">战争</el-checkbox>\r\n            </el-checkbox-group>\r\n          </el-form-item>\r\n          <!--      图片上传-->\r\n\r\n          <el-form-item>\r\n            <el-button type=\"primary\" @click=\"submitMovieForm('movieFrom')\">立即创建</el-button>\r\n            <el-button @click=\"resetForm('movieFrom')\">重置</el-button>\r\n          </el-form-item>\r\n        </el-form>\r\n\r\n      </el-col>\r\n    </el-row>\r\n\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"createMovie\",\r\n  data(){\r\n    return{\r\n      movieFrom:{\r\n        movieName:'',\r\n        movieCover:'',\r\n        movieBio:'',\r\n        movieRegion:[],\r\n        movieTime:'',\r\n        movieLang:[],\r\n        movieRelDate:'',\r\n        actorList:[],\r\n        directorList:[],\r\n        typeList:[],\r\n      },\r\n      fileList:[],\r\n      options:[],\r\n      directOptions:[],\r\n      list:[],\r\n      loading: false,\r\n      movieFromRules:{\r\n        movieName: [\r\n          {required: true, message: '请输入电影名', trigger: 'blur'},\r\n        ],\r\n      },\r\n    };\r\n  },\r\n  methods:{\r\n    checkId() {\r\n      let uid = this.$cookie.get('userId')\r\n      let type = this.$cookie.get('type')\r\n      if (type==1){\r\n        this.$router.go(-1)\r\n      }else{\r\n        this.$axios({\r\n          method:\"get\",\r\n          url:'/getUserById',\r\n          params:{\r\n            userId:uid,\r\n          },\r\n        }).then(res=>{\r\n          if(res.data.result){\r\n            if(res.data.type){\r\n              this.$cookie.remove('userId');\r\n              this.$cookie.remove('type');\r\n              this.$router.push('/log')\r\n              this.$message.error('非管理员用户，请重新登陆')\r\n            }else{\r\n              this.$message.warning('欢迎登录HERec管理员')\r\n            }\r\n          }else{\r\n            this.$cookie.remove('userId');\r\n            this.$cookie.remove('type');\r\n            this.$router.push('/log')\r\n            this.$message.error('非管理员用户，请重新登陆')\r\n          }\r\n        })\r\n      }\r\n    },\r\n    getPerson(){\r\n      this.$axios({\r\n        method:\"get\",\r\n        url:'/getPerson',\r\n      }).then(res=>{\r\n        this.list = res.data.personList.map(item=>{\r\n          return{\r\n            value:item[0],\r\n            label:item[1],\r\n          }\r\n        })\r\n      })\r\n    },\r\n    selectActor(query) {\r\n      if (query !== '') {\r\n        this.loading = true;\r\n        setTimeout(() => {\r\n          this.loading = false;\r\n          this.options = this.list.filter(item => {\r\n            return item.label.toLowerCase()\r\n                .indexOf(query.toLowerCase()) > -1;\r\n          });\r\n        }, 200);\r\n      } else {\r\n        this.options = [];\r\n      }\r\n    },\r\n    selectDirector(query) {\r\n      if (query !== '') {\r\n        this.loading = true;\r\n        setTimeout(() => {\r\n          this.loading = false;\r\n          this.directOptions = this.list.filter(item => {\r\n            return item.label.toLowerCase()\r\n                .indexOf(query.toLowerCase()) > -1;\r\n          });\r\n        }, 200);\r\n      } else {\r\n        this.directOptions = [];\r\n      }\r\n    },\r\n\r\n    submitMovieForm(form){\r\n      this.$refs[form].validate((valid) => {\r\n        if (valid) {\r\n          this.$refs.upload.submit();\r\n        } else {\r\n          this.$message.error('请仔细填写信息哦');\r\n          return false;\r\n        }\r\n      })\r\n    },\r\n    resetForm(form){\r\n\r\n    },\r\n    httpRequest(param){\r\n      console.log(param)\r\n      let fileObj = param.file\r\n      let fd = new FormData()\r\n      fd.append('file',fileObj)\r\n      for (let i in this.movieFrom) {\r\n        console.log(i)\r\n        fd.append(i, this.movieFrom[i])\r\n      }\r\n      this.$axios({\r\n            method: 'post',\r\n            url: '/createMovie',\r\n            data: fd,\r\n            header: {\r\n              'Content-Type': 'multipart/form-data'  //如果写成contentType会报错\r\n            }\r\n          }\r\n      ).then(res => {\r\n        if (res.data.result === false) {\r\n          this.$message.error('注册失败，请重新处理信息');\r\n          //修改失败，重新注册\r\n        } else {\r\n          this.$message({\r\n            message: '初始化成功',\r\n            type: 'warning'\r\n          });\r\n        }\r\n      })\r\n\r\n    },\r\n    handleAvatarSuccess(res, file) {\r\n      this.imageUrl = URL.createObjectURL(file.raw);\r\n    },\r\n    beforeAvatarUpload(file) {\r\n      let types = ['image/jpeg', 'image/jpg', 'image/png'];\r\n      const isJPG = types.includes(file.type);\r\n      const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n      if (!isJPG) {\r\n        this.$message.error('上传图片只能是 JPG 格式!');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!');\r\n      }\r\n      return isJPG && isLt2M;\r\n    },\r\n\r\n  },\r\n  created() {\r\n    this.checkId()\r\n    this.getPerson()\r\n  },\r\n  mounted() {\r\n\r\n  },\r\n}\r\n</script>\r\n\r\n<style>\r\n.avatar-uploader .el-upload {\r\n  border: 1px dashed #d9d9d9;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n.avatar-uploader .el-upload:hover {\r\n  border-color: #409EFF;\r\n}\r\n.avatar-uploader-icon {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 178px;\r\n  height: 178px;\r\n  line-height: 178px;\r\n  text-align: center;\r\n}\r\n.avatar {\r\n  width: 178px;\r\n  height: 178px;\r\n  display: block;\r\n}\r\n</style>"]}]}