{"remainingRequest":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\src\\pages\\movieDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\src\\pages\\movieDetail.vue","mtime":1651857760315},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1646917067899},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\babel-loader\\lib\\index.js","mtime":1646917103326},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1646917067899},{"path":"C:\\Users\\Sherwin\\Documents\\GitHub\\HERec\\node_modules\\vue-loader\\lib\\index.js","mtime":1646917096669}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  props: {\n    mid: {\n      type: Number,\n      default: 0\n    }\n  },\n  name: \"movieDetail\",\n  data: function data() {\n    return {\n      imgLoad: false,\n      commentForm: {\n        userComment: ''\n      },\n      movieName: '',\n      //电影名称\n      movieBio: '',\n      //电影简介\n      movieTime: \"\",\n      //电影时长\n      movieRelDate: \"\",\n      //电影发布日\n      movieLang: \"\",\n      //电影语言\n      movieRegion: \"\",\n      //电影生产国地区\n      movieCover: \"\",\n      //电影封面\n      typeList: [],\n      //电影的类型列表\n      actorList: [],\n      //演员列表\n      directorList: [],\n      //导演列表，\n      value: 6,\n      //电影平均分\n      percentOneStar: 0,\n      //1星打分人数百分比\n      percentTwoStar: 0,\n      //2星打分人数百分比\n      percentThreeStar: 0,\n      //3星打分人数百分比\n      percentFourStar: 0,\n      //4星打分人数百分比\n      percentFiveStar: 0,\n      //5星打分人数百分比\n      userScore: 0,\n      //当前用户给电影的打分\n      commentNum: 0,\n      //评论总数\n      commentList: [],\n      //评论列表，userName,uid,comment,vote,score,id\n      userText: '',\n      curPage: 1,\n      //分页的当前页\n      voteStar: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //评论点赞\n\n    };\n  },\n  methods: {\n    getMovieInfo: function getMovieInfo() {\n      var _this = this;\n\n      this.$axios({\n        method: \"get\",\n        url: \"/getMovieByMovieId\",\n        params: {\n          mid: this.mid\n        }\n      }).then(function (res) {\n        if (res.data.result) {\n          _this.movieName = res.data.movieInfo.movieName;\n          _this.movieBio = res.data.movieInfo.movieBio;\n          _this.movieLang = res.data.movieInfo.movieLang;\n          _this.movieTime = res.data.movieInfo.movieTime;\n          _this.movieRelDate = res.data.movieInfo.movieRelDate;\n          _this.movieRegion = res.data.movieInfo.movieRegion;\n          _this.movieCover = res.data.movieInfo.movieImg;\n          _this.actorList = res.data.actor;\n          _this.typeList = res.data.type;\n          _this.directorList = res.data.director;\n          _this.imgLoad = true;\n        } else {\n          _this.$message.error('无此电影404');\n\n          _this.$router.go(-1);\n        }\n      });\n    },\n    getRateByMid: function getRateByMid() {\n      var _this2 = this;\n\n      this.$axios({\n        method: \"get\",\n        url: '/getRateByMid',\n        params: {\n          mid: this.mid\n        }\n      }).then(function (res) {\n        if (res.data.result) {\n          _this2.value = res.data.avgScore;\n          _this2.percentOneStar = res.data.perList[0];\n          _this2.percentTwoStar = res.data.perList[1];\n          _this2.percentThreeStar = res.data.perList[2];\n          _this2.percentFourStar = res.data.perList[3];\n          _this2.percentFiveStar = res.data.perList[4];\n        } else {\n          _this2.value = 0;\n          _this2.percentOneStar = 0;\n          _this2.percentTwoStar = 0;\n          _this2.percentThreeStar = 0;\n          _this2.percentFourStar = 0;\n          _this2.percentFiveStar = 0;\n        }\n      });\n    },\n    getCommentsByMid: function getCommentsByMid() {\n      var _this3 = this;\n\n      var hasU = false;\n\n      if (this.$cookie.get('userId')) {\n        hasU = true;\n      }\n\n      this.$axios({\n        method: \"get\",\n        url: '/getCommentsByMid',\n        params: {\n          mid: this.mid,\n          hasUid: hasU,\n          uid: this.$cookie.get('userId'),\n          curPage: this.curPage\n        }\n      }).then(function (res) {\n        _this3.commentNum = res.data.commentNum;\n        _this3.commentList = res.data.commentList;\n        _this3.voteStar = res.data.voteStar;\n\n        if (res.data.userComment) {\n          _this3.commentForm.userComment = res.data.userComment;\n        }\n      });\n    },\n    jumpPersonDetail: function jumpPersonDetail(pid) {\n      // console.log(\"jump\")\n      this.$router.push({\n        name: 'personDetail',\n        params: {\n          pid: parseInt(pid)\n        }\n      });\n    },\n    commentVote: function commentVote(cid, uid, index) {\n      var _this4 = this;\n\n      if (this.$cookie.get('userId')) {\n        this.$axios({\n          method: \"get\",\n          url: '/commentVote',\n          params: {\n            cid: cid,\n            uid: uid\n          }\n        }).then(function (res) {\n          if (res.data.result) {\n            _this4.voteStar[index] = 1;\n\n            _this4.getCommentsByMid();\n          }\n        });\n      } else {\n        this.$message.error('请先登录再操作');\n        this.$router.push('/log');\n      }\n    },\n    cancelCommentVote: function cancelCommentVote(cid, uid, index) {\n      var _this5 = this;\n\n      if (this.$cookie.get('userId')) {\n        this.$axios({\n          method: \"get\",\n          url: '/cancelCommentVote',\n          params: {\n            cid: cid,\n            uid: uid\n          }\n        }).then(function (res) {\n          if (res.data.result) {\n            _this5.voteStar[index] = 0;\n\n            _this5.getCommentsByMid();\n          }\n        });\n      } else {\n        this.$message.error('请先登录再操作');\n        this.$router.push('/log');\n      }\n    },\n    submitComment: function submitComment() {\n      var _this6 = this;\n\n      var userRate = this.userScore;\n      var userComment = this.commentForm.userComment;\n      var uid = this.$cookie.get('userId');\n      var mid = this.mid;\n\n      if (uid) {\n        this.$axios({\n          method: \"get\",\n          url: '/submitComment',\n          params: {\n            uid: uid,\n            mid: mid,\n            score: userRate,\n            comment: userComment\n          }\n        }).then(function (res) {\n          if (res.data.result) {\n            _this6.$message.warning('评论成功');\n\n            _this6.getCommentsByMid();\n          } else {\n            _this6.$message.error('请先登录，再评价');\n          }\n        });\n      } else {\n        this.$message.error('请先登录，再评论');\n      }\n    },\n    modifyMovie: function modifyMovie(mid) {\n      this.$router.push({\n        name: 'modifyMovie',\n        params: {\n          mid: parseInt(mid)\n        }\n      });\n    }\n  },\n  created: function created() {\n    var _this7 = this;\n\n    this.getMovieInfo();\n    this.getRateByMid();\n    this.getCommentsByMid();\n\n    if (this.$cookie.get('userId')) {\n      this.$axios({\n        method: \"get\",\n        url: '/getRateByMidAndUid',\n        params: {\n          uid: this.$cookie.get('userId'),\n          mid: this.mid\n        }\n      }).then(function (res) {\n        if (res.data.result) {\n          _this7.userScore = res.data.score;\n        } else {\n          _this7.userScore = 0;\n        }\n      });\n    }\n  },\n  watch: {\n    userScore: function userScore(newval, oldval) {\n      var _this8 = this;\n\n      if (this.$cookie.get('userId')) {\n        this.$axios({\n          method: \"get\",\n          url: '/rateMovie',\n          params: {\n            uid: this.$cookie.get('userId'),\n            mid: this.mid,\n            score: newval\n          }\n        }).then(function (res) {\n          if (res.data.result) {\n            _this8.$message.success('评分成功');\n\n            console.log('评分成功');\n\n            _this8.getCommentsByMid();\n          }\n        });\n      } else {\n        this.$router.push({\n          name: 'log'\n        });\n      }\n    }\n  }\n};",{"version":3,"sources":["movieDetail.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"movieDetail\">\r\n    <el-row>\r\n      <el-col :span=\"12\" :offset=\"3\">\r\n        <div id=\"movieTitle\">\r\n          <h1>{{this.movieName}} <i v-if=\"$cookie.get('type')==0\" class=\"el-icon-s-tools\" @click=\"modifyMovie(mid)\" ></i></h1>\r\n\r\n        </div>\r\n      </el-col>\r\n    </el-row>\r\n    <el-row>\r\n      <el-col :span=\"2\" :offset=\"3\">\r\n        <div id=\"movieCover\" style=\"background: #2c3e50\" >\r\n          <el-image v-if=\"imgLoad\" :src=\"this.$store.getters.getMediaUrl + movieCover\" :fit=\"'scale-down'\"></el-image>\r\n        </div>\r\n      </el-col>\r\n      <el-col :span=\"7\" :offset=\"1\">\r\n        <div id=\"movieInfo\">\r\n          <el-descriptions class=\"margin-top\" title=\"\" :column=\"1\">\r\n            <el-descriptions-item label=\"导演\" label-class-name=\"movieDirector\">\r\n              <div style=\"cursor: pointer\" @click=\"alert(directorList)\">\r\n                <span v-for=\"d in this.directorList\" @click=\"jumpPersonDetail(d.directorIdOld)\">\r\n                  {{d.personName}}/\r\n                </span>\r\n              </div>\r\n            </el-descriptions-item>\r\n            <el-descriptions-item label=\"主演\" label-class-name=\"movieActor\">\r\n              <span v-for=\"d in this.actorList\" @click=\"jumpPersonDetail(d.actorIdOld)\">\r\n                {{d.personName}}/\r\n              </span>\r\n            </el-descriptions-item>\r\n            <el-descriptions-item label=\"类型\" label-class-name=\"movieDirector\">\r\n              <el-tag size=\"small\" v-for=\"t in this.typeList\" style=\"margin-right: 3px\">{{ t }}</el-tag>\r\n            </el-descriptions-item>\r\n            <el-descriptions-item label=\"语言\" label-class-name=\"movieDirector\">{{ this.movieLang }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"电影时长\" label-class-name=\"movieDirector\">{{ this.movieTime }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"制片国家/地区\" label-class-name=\"movieDirector\">{{ this.movieRegion }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"上映时间\" label-class-name=\"movieDirector\">{{ this.movieRelDate }}</el-descriptions-item>\r\n          </el-descriptions>\r\n        </div>\r\n      </el-col>\r\n      <el-col :span=\"1\"><br/>\r\n        <el-divider direction=\"vertical\"></el-divider>\r\n      </el-col>\r\n      <el-col :span=\"4\">\r\n        评分\r\n        <el-rate\r\n            v-model=\"value\"\r\n            disabled\r\n            show-score\r\n            text-color=\"#ff9900\"\r\n            score-template=\"{value}\">\r\n        </el-rate>\r\n        <table style=\"width: 13em\">\r\n          <tr>\r\n            <td style=\"width: 2em\">1星</td>\r\n            <td>\r\n              <el-progress :percentage=\"this.percentOneStar\" ></el-progress>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>2星</td>\r\n            <td>\r\n              <el-progress :percentage=\"this.percentTwoStar\"></el-progress>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>3星</td>\r\n            <td>\r\n              <el-progress :percentage=\"this.percentThreeStar\"></el-progress>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>4星</td>\r\n            <td>\r\n              <el-progress :percentage=\"this.percentFourStar\"></el-progress>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>5星</td>\r\n            <td>\r\n              <el-progress :percentage=\"this.percentFiveStar\"></el-progress>\r\n            </td>\r\n          </tr>\r\n        </table>\r\n      </el-col>\r\n    </el-row>\r\n    <el-row>\r\n      <el-col :span=\"10\" :offset=\"3\">\r\n        <div ></div>\r\n      </el-col>\r\n    </el-row>\r\n    <el-row>\r\n      <el-col :offset=\"3\" :span=\"15\">\r\n        <h4> 我的评价：</h4>\r\n        <el-rate  v-model=\"userScore\" show-text></el-rate>\r\n        <h4>{{this.movieName}}的电影简介</h4>\r\n        {{this.movieBio}}\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <el-row style=\"margin-top: 2em\">\r\n      <el-col :offset=\"3\" :span=\"15\">\r\n        <el-form ref=\"commentForm\" :model=\"commentForm\" label-width=\"80px\" size=\"mini\">\r\n          <el-form-item label=\"我的评论\">\r\n            <el-input type=\"textarea\" placeholder=\"请输入内容\" v-model=\"commentForm.userComment\" maxlength=\"500\" show-word-limit style=\"margin-bottom: 1em\">\r\n            </el-input>\r\n          </el-form-item>\r\n          <el-form-item style=\"text-align: right\">\r\n            <el-button type=\"success\" @click=\"submitComment\" size=\"mini\" >评论</el-button>\r\n          </el-form-item>\r\n        </el-form>\r\n\r\n        <div style=\"margin-top: 1em;margin-bottom: 1em\">\r\n          <p style=\"color:#007722; font-size: 14px\" >········最热影评········共计{{this.commentNum}}条评论</p>\r\n        </div>\r\n\r\n        <div v-for=\"(c,index) in this.commentList\" :key=\"index\"><!--评论模块-->\r\n          <el-row>\r\n            <el-col :span=\"3\" style=\"font-size: 12px;\">\r\n              <span>\r\n                {{c.userName}}\r\n              </span>\r\n            </el-col>\r\n            <el-col :span=\"5\">\r\n                <el-rate v-model=\"c.score\" disabled text-color=\"#ff9900\"></el-rate>\r\n            </el-col>\r\n            <el-col :span=\"4\" :offset=\"12\" style=\"text-align: right\">\r\n              {{c.vote}}\r\n              <i class=\"el-icon-star-on\" v-if=\"voteStar[index]\" style=\"color:#E6A23C\" @click=\"cancelCommentVote(c.id,$cookie.get('userId'),index)\"></i>\r\n              <i class=\"el-icon-star-off\" v-else @click=\"commentVote(c.id,$cookie.get('userId'),index)\" ></i>\r\n            </el-col>\r\n          </el-row>\r\n          <el-row >\r\n            <el-col>\r\n            <span style=\"font-size: 13px\">\r\n              {{c.comment}}\r\n            </span>\r\n            </el-col>\r\n          </el-row>\r\n          <el-divider></el-divider>\r\n        </div>\r\n\r\n        <el-pagination\r\n            background\r\n            :current-page.sync=\"curPage\"\r\n            layout=\"prev, pager, next\"\r\n            :total=\"this.commentNum\"\r\n            @current-change=\"getCommentsByMid\"\r\n        >\r\n        </el-pagination>\r\n      </el-col>\r\n    </el-row>\r\n\r\n\r\n\r\n\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: {\r\n    mid: {\r\n      type: Number,\r\n      default: 0\r\n    }\r\n  },\r\n  name: \"movieDetail\",\r\n  data(){\r\n    return{\r\n      imgLoad:false,\r\n      commentForm:{\r\n        userComment:'',\r\n      },\r\n      movieName:'',//电影名称\r\n      movieBio:'',//电影简介\r\n      movieTime:\"\",//电影时长\r\n      movieRelDate:\"\",//电影发布日\r\n      movieLang:\"\",//电影语言\r\n      movieRegion:\"\",//电影生产国地区\r\n      movieCover:\"\",//电影封面\r\n      typeList:[],//电影的类型列表\r\n      actorList:[],//演员列表\r\n      directorList:[],//导演列表，\r\n      value:6,//电影平均分\r\n      percentOneStar:0,//1星打分人数百分比\r\n      percentTwoStar:0,//2星打分人数百分比\r\n      percentThreeStar:0,//3星打分人数百分比\r\n      percentFourStar:0,//4星打分人数百分比\r\n      percentFiveStar:0,//5星打分人数百分比\r\n      userScore:0,//当前用户给电影的打分\r\n      commentNum:0,//评论总数\r\n      commentList:[],//评论列表，userName,uid,comment,vote,score,id\r\n      userText:'',\r\n      curPage:1,//分页的当前页\r\n      voteStar:[0,0,0,0,0,0,0,0,0,0]//评论点赞\r\n    };\r\n\r\n  },\r\n  methods:{\r\n    getMovieInfo(){\r\n      this.$axios({\r\n        method:\"get\",\r\n        url:\"/getMovieByMovieId\",\r\n        params:{\r\n          mid:this.mid,\r\n        }\r\n      }).then(res=>{\r\n        if (res.data.result){\r\n          this.movieName=res.data.movieInfo.movieName;\r\n          this.movieBio=res.data.movieInfo.movieBio;\r\n          this.movieLang = res.data.movieInfo.movieLang;\r\n          this.movieTime=res.data.movieInfo.movieTime;\r\n          this.movieRelDate=res.data.movieInfo.movieRelDate;\r\n          this.movieRegion = res.data.movieInfo.movieRegion;\r\n          this.movieCover = res.data.movieInfo.movieImg;\r\n          this.actorList = res.data.actor;\r\n          this.typeList = res.data.type;\r\n          this.directorList = res.data.director;\r\n          this.imgLoad=true;\r\n        }else{\r\n          this.$message.error('无此电影404');\r\n          this.$router.go(-1);\r\n        }\r\n      })\r\n    },\r\n    getRateByMid(){\r\n      this.$axios({\r\n        method:\"get\",\r\n        url:'/getRateByMid',\r\n        params:{\r\n          mid:this.mid,\r\n        }\r\n      }).then(res=>{\r\n        if (res.data.result){\r\n          this.value=res.data.avgScore;\r\n          this.percentOneStar=res.data.perList[0];\r\n          this.percentTwoStar=res.data.perList[1];\r\n          this.percentThreeStar=res.data.perList[2];\r\n          this.percentFourStar=res.data.perList[3];\r\n          this.percentFiveStar=res.data.perList[4];\r\n        }else{\r\n          this.value=0;\r\n          this.percentOneStar=0;\r\n          this.percentTwoStar=0;\r\n          this.percentThreeStar=0;\r\n          this.percentFourStar=0;\r\n          this.percentFiveStar=0;\r\n        }\r\n      })\r\n    },\r\n    getCommentsByMid(){\r\n      let hasU = false\r\n      if (this.$cookie.get('userId')){\r\n        hasU = true\r\n      }\r\n      this.$axios({\r\n        method:\"get\",\r\n        url:'/getCommentsByMid',\r\n        params:{\r\n          mid:this.mid,\r\n          hasUid:hasU,\r\n          uid:this.$cookie.get('userId'),\r\n          curPage:this.curPage,\r\n        }\r\n      }).then(res=>{\r\n        this.commentNum=res.data.commentNum\r\n        this.commentList=res.data.commentList\r\n        this.voteStar=res.data.voteStar\r\n        if (res.data.userComment){\r\n          this.commentForm.userComment=res.data.userComment\r\n        }\r\n      })\r\n    },\r\n    jumpPersonDetail(pid){\r\n      // console.log(\"jump\")\r\n      this.$router.push({name:'personDetail',params:{pid:parseInt(pid)}});\r\n    },\r\n    commentVote(cid,uid,index){\r\n      if (this.$cookie.get('userId')){\r\n        this.$axios({\r\n          method:\"get\",\r\n          url:'/commentVote',\r\n          params:{\r\n            cid:cid,\r\n            uid:uid,\r\n          }\r\n        }).then(res=>{\r\n          if (res.data.result){\r\n            this.voteStar[index]=1\r\n            this.getCommentsByMid()\r\n          }\r\n        })\r\n      }else{\r\n        this.$message.error('请先登录再操作')\r\n        this.$router.push('/log')\r\n      }\r\n    },\r\n    cancelCommentVote(cid,uid,index){\r\n      if (this.$cookie.get('userId')){\r\n        this.$axios({\r\n          method:\"get\",\r\n          url:'/cancelCommentVote',\r\n          params:{\r\n            cid:cid,\r\n            uid:uid,\r\n          }\r\n        }).then(res=>{\r\n          if (res.data.result){\r\n            this.voteStar[index]=0\r\n            this.getCommentsByMid()\r\n          }\r\n        })\r\n      }else{\r\n        this.$message.error('请先登录再操作')\r\n        this.$router.push('/log')\r\n      }\r\n    },\r\n    submitComment(){\r\n      let userRate = this.userScore\r\n      let userComment = this.commentForm.userComment\r\n      let uid = this.$cookie.get('userId')\r\n      let mid = this.mid\r\n      if (uid){\r\n        this.$axios({\r\n          method:\"get\",\r\n          url:'/submitComment',\r\n          params:{\r\n            uid:uid,\r\n            mid:mid,\r\n            score: userRate,\r\n            comment: userComment,\r\n          }\r\n        }).then(res=>{\r\n          if(res.data.result){\r\n            this.$message.warning('评论成功')\r\n            this.getCommentsByMid()\r\n          }else{\r\n            this.$message.error('请先登录，再评价')\r\n          }\r\n        })\r\n      }else {\r\n        this.$message.error('请先登录，再评论')\r\n      }\r\n    },\r\n    modifyMovie(mid){\r\n      this.$router.push({name:'modifyMovie',params:{mid:parseInt(mid)}})\r\n    },\r\n  },\r\n  created() {\r\n    this.getMovieInfo()\r\n    this.getRateByMid()\r\n    this.getCommentsByMid()\r\n    if(this.$cookie.get('userId')){\r\n      this.$axios({\r\n        method:\"get\",\r\n        url:'/getRateByMidAndUid',\r\n        params:{\r\n          uid:this.$cookie.get('userId'),\r\n          mid:this.mid\r\n        },\r\n      }).then(res=>{\r\n        if (res.data.result){\r\n          this.userScore = res.data.score;\r\n        }else{\r\n          this.userScore = 0;\r\n        }\r\n      })\r\n    }\r\n  },\r\n  watch:{\r\n    userScore:function (newval,oldval){\r\n      if(this.$cookie.get('userId')){\r\n        this.$axios({\r\n          method:\"get\",\r\n          url:'/rateMovie',\r\n          params:{\r\n            uid:this.$cookie.get('userId'),\r\n            mid:this.mid,\r\n            score:newval,\r\n          }\r\n        }).then(res=>{\r\n          if(res.data.result){\r\n            this.$message.success('评分成功')\r\n            console.log('评分成功')\r\n            this.getCommentsByMid()\r\n          }\r\n        })\r\n      }else{\r\n        this.$router.push({name:'log'})\r\n      }\r\n\r\n    }\r\n  },\r\n\r\n}\r\n</script>\r\n\r\n<style>\r\n.movieDetail {\r\n\r\n}\r\n#movieTitle{\r\n\r\n}\r\n#movieCover{\r\n  margin-top: 1em;\r\n  width: 9em;\r\n  height: 12em;\r\n}\r\n.movieDirector{\r\n  width: 7em;\r\n  /*background: #E1F3D8;*/\r\n}\r\n.movieActor{\r\n  width: 7em;\r\n  /*background: #E1F3D8;*/\r\n}\r\n</style>"],"sourceRoot":"src/pages"}]}